---
title: Mutliple Time Series Granger Causality
author: ''
date: '2019-06-12'
slug: mutliple-time-series-granger-causality
categories: []
tags: []
image:
  caption: ''
  focal_point: ''
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/viz/viz.js"></script>
<link href="/rmarkdown-libs/DiagrammeR-styles/styles.css" rel="stylesheet" />
<script src="/rmarkdown-libs/grViz-binding/grViz.js"></script>


<p>We have recently submitted a paper about the short-term car registration forecasting. Forecasting models were based on several underlying variables which were analysed by a standard Vector Autoregressive Model. As the main purpose of the paper was not to present a black-box model with a good predictive power, we needed to analyse an importants of the car registration determinants.</p>
<p>A traditional approach to identify <em>“cause and effects”</em> in the context of time series analysis is to perform the Granger Causality test. Surprisingly, a treatment of the multivariate is not discussed much. Typically, two variables settings is presented with the caveat that solution works even for a more variables. This is only a partially true.</p>
<p>In the following text we will go through the simple 3 time-series example with various settings of interconnections.</p>
<div id="three-variables-one-driver" class="section level2">
<h2>Three Variables, One driver</h2>
<p>This example shows the analysis of the tree time series where the first time series <em>ts1</em> is a confounding time series.</p>
<pre class="r"><code>library(DiagrammeR)

grViz(&quot;
 digraph boxes_and_circles {

 graph [overlap = false, fontsize = 1, rankdir=&#39;LR&#39;]

 TS1 -&gt; TS2 [label = &#39;AR1 + &amp;#945;&amp;#183;TS1&#39;]
 TS2 -&gt; TS3 [label = &#39;No Relation&#39;, color= &#39;red&#39;, fontcolor=&#39;red&#39;] 
 TS1 -&gt; TS3 [label = &#39;AR1 + &amp;#946;&amp;#183;TS1&#39;]
}
&quot;)</code></pre>
<div id="htmlwidget-1" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"diagram":"\n digraph boxes_and_circles {\n\n graph [overlap = false, fontsize = 1, rankdir=\"LR\"]\n\n TS1 -> TS2 [label = \"AR1 + &#945;&#183;TS1\"]\n TS2 -> TS3 [label = \"No Relation\", color= \"red\", fontcolor=\"red\"] \n TS1 -> TS3 [label = \"AR1 + &#946;&#183;TS1\"]\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p>The first time series (TS) is generated as an autoregressive proces AR(1):</p>
<pre class="r"><code>library(dplyr)

ts1 &lt;-  arima.sim(n = 100, list(ar = c(0.7)), sd = 1/2) %&gt;% as.numeric</code></pre>
<p>The second time series TS2 is computed as a standalone AR(1) process plus TS2 multiplied by value <span class="math inline">\(\alpha=0.7\)</span>. Similarly, TS is based only only on its own autoregressive part plus <span class="math inline">\(\beta=0.7 \cdot TS1\)</span> values.</p>
<pre class="r"><code>alpha &lt;- 0.7
beta  &lt;- 0.7

ts2 &lt;- arima.sim(n = 100, list(ar = c(0.7)), sd = 1/2) + alpha * dplyr::lag(ts1, 1) 
ts3 &lt;- arima.sim(n = 100, list(ar = c(0.7)), sd = 1/2) + beta * dplyr::lag(ts1, 1) 

ts1 &lt;- ts1 %&gt;% as.numeric
ts2 &lt;- ts2 %&gt;% as.numeric</code></pre>
<pre class="r"><code>grViz(&quot;
 digraph boxes_and_circles {

 graph [overlap = false, fontsize = 1, rankdir=&#39;LR&#39;]

 TS1 -&gt; TS2 [label = &#39;AR1 + &amp;#945;&amp;#183;TS1&#39;]
 TS2 -&gt; TS3 [label = &#39;AR1 + &amp;#947;&amp;#183;TS2&#39;] 
 TS1 -&gt; TS3 [label = &#39;AR1 + &amp;#946;&amp;#183;TS1&#39;]
}
&quot;)</code></pre>
<div id="htmlwidget-2" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"diagram":"\n digraph boxes_and_circles {\n\n graph [overlap = false, fontsize = 1, rankdir=\"LR\"]\n\n TS1 -> TS2 [label = \"AR1 + &#945;&#183;TS1\"]\n TS2 -> TS3 [label = \"AR1 + &#947;&#183;TS2\"] \n TS1 -> TS3 [label = \"AR1 + &#946;&#183;TS1\"]\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code>gamma &lt;- 0.7

 ts1 &lt;-  arima.sim(n = 100, list(ar = c(0.7)), sd = 1/2) %&gt;% as.numeric
 ts2 &lt;-  arima.sim(n = 100, list(ar = c(0.7)), sd = 1/2) + 
   alpha * dplyr::lag(ts1, 1) %&gt;% as.numeric
 ts3 &lt;-  arima.sim(n = 100, list(ar = c(0.7)), sd = 1/2) + 
   beta  * dplyr::lag(ts1, 1) + c(NA, gamma * dplyr::lag(ts2[-1], 1) ) %&gt;% as.numeric</code></pre>
</div>
